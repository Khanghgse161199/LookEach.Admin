@page "/LookEach/SignUp"
@using LookEach.User.API
@using LookEach.User.Model
@using LookEach.User.Utilites
@inject IJSRuntime JSRuntime;
@inject NavigationManager NavigationManager
<PageTitle>LookEach - Đăng Ký</PageTitle>

<div class="page-title-area">
    <div class="container">
        <div class="page-title-content">
            <!-- <h2>Đăng ký</h2> -->
            <ul>
                <li><a href="/">Trang Chủ</a></li>
                <li style="color: #47261D;">Đăng Ký</li>
            </ul>
        </div>
    </div>
</div>

<section class="signup-area ptb-100" style="padding-top: 37px;">
    <div class="container py-5 wow fadeInUp" data-wow-delay="0.3s">
        <div class="row">
            <div class="col-lg-5 col-md-5 col-sm-12">
                <img style="border-radius: 10px;" src="assets/img/Default_1.png">
            </div>
            <div class="col-lg-7 col-md-7 col-sm-12" id="input-info">
                <div class="signup-content">
                    <h2>Đăng Ký Tài Khoản</h2>
                    @*    <div class="signup-form"> *@
                    <div class="form-group">
                        <!-- <label>Tên đăng nhập</label> -->
                        <input type="text" class="form-control" @bind-value="_user.Name" placeholder="Họ và tên" id="fname"
                               name="fname">
                    </div>
                    <br />
                    <div class="form-group">
                        <!-- <label>Email</label> -->
                        <input type="email" class="form-control" @bind-value="_user.Email" placeholder="Email" id="name" name="name">
                    </div>
                    <br />
                    <div class="form-group">
                        <!-- <label>Số điện thoại</label> -->
                        <input type="number" @bind-value="_user.Phone" class="form-control" placeholder="Số điện thoại" id="lname"
                               name="lname">
                    </div>
                    <br />
                    <div class="form-group">
                        <input type="password" @bind-value="_user.Password" class="form-control" placeholder="Mật khẩu" id="password"
                               name="password">
                    </div>
                    <br />
                    <div class="form-group">
                        <input type="password" @bind-value="_passwordConfirm" class="form-control" placeholder="Xác nhận mật khẩu"
                               id="password" name="password">
                    </div>
                    <br />
                   <div>
                        <button class="default-btn" onclick="@RegisterCustomerEven">Đăng ký</button>
                   </div>
                    <br />
                    <div class="bottom-sigin"
                         style="display: inline-block; color: #777777; font-weight: 500; font-size: 14.5px;">
                        Bạn
                        đã có tài khoản? <a href="/LookEach/Login" class="return-store"> Đăng nhập</a>
                    </div>
                </div>
                @*      </div> *@
            </div>
        </div>
    </div>
</section>


@code {
    private Command _cmd { get; set; } = new Command();
    private UserCreateModel _user { get; set; } = new UserCreateModel();

    private string _passwordConfirm { get; set; } = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    private async Task RegisterCustomerEven()
    {
        var validate = await UtilitesFunction.ValidateAsync(_user, _passwordConfirm);
        if (!validate.Validate)
        {
            await JSRuntime.InvokeVoidAsync("AnnountMessage", 2, validate.Message);
            return;
        }

        var resopnse = await _cmd.RegisterCustomerAsync(_user);
        if (resopnse != null)
        {
            _user = new UserCreateModel();
            await JSRuntime.InvokeVoidAsync("AnnountMessage", 1, "Đăng ký khách hàng thành công");
            await Task.Delay(3000);
            NavigationManager.NavigateTo("/LookEach/Login");
        }
        else await JSRuntime.InvokeVoidAsync("AnnountMessage", 2, "Lỗi hệ thống - Đăng ký khách hàng không thành công!");
    }
}
